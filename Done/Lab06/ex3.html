<!doctype html>
<html lang="en">


<!-- nhớ chạy:macbookpro@TTrung-2 lab6_web_522H0148 % php -S localhost:8080
nhớ chạy: macbookpro@TTrung-2 lab6_web_522H0148 % sudo chmod -R 777 /Applications/XAMPP/xamppfiles/htdocs/ để cấp quyền cho thư mục htdocs, cho phép sửa file cmts.txt -->

<!-- nhớ chạy:macbookpro@TTrung-2 lab6_web_522H0148 % php -S localhost:8080
nhớ chạy: macbookpro@TTrung-2 lab6_web_522H0148 % sudo chmod -R 777 /Applications/XAMPP/xamppfiles/htdocs/ để cấp quyền cho thư mục htdocs, cho phép sửa file cmts.txt -->

<!-- nhớ chạy:macbookpro@TTrung-2 lab6_web_522H0148 % php -S localhost:8080
nhớ chạy: macbookpro@TTrung-2 lab6_web_522H0148 % sudo chmod -R 777 /Applications/XAMPP/xamppfiles/htdocs/ để cấp quyền cho thư mục htdocs, cho phép sửa file cmts.txt -->

<!-- nhớ chạy:macbookpro@TTrung-2 lab6_web_522H0148 % php -S localhost:8080
nhớ chạy: macbookpro@TTrung-2 lab6_web_522H0148 % sudo chmod -R 777 /Applications/XAMPP/xamppfiles/htdocs/ để cấp quyền cho thư mục htdocs, cho phép sửa file cmts.txt -->

<!-- nhớ chạy:macbookpro@TTrung-2 lab6_web_522H0148 % php -S localhost:8080
nhớ chạy: macbookpro@TTrung-2 lab6_web_522H0148 % sudo chmod -R 777 /Applications/XAMPP/xamppfiles/htdocs/ để cấp quyền cho thư mục htdocs, cho phép sửa file cmts.txt -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
        integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <title>PHP Exercises</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-8 my-3 mx-auto p-3">
                <div class="border rounded p-3">
                    <h4 class="text-center mb-3">Nhập bình luận của bạn</h4>
                    <form action="ex3-api.php" method="post">
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="name">Họ và tên</label>
                                <input id="name" name="name" type="text" class="form-control">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="type">Chọn màu nền</label>
                                <select id="type" name="type" class="custom-select">
                                    <option value="alert-secondary" selected>Gray</option>
                                    <option value="alert-success">Green</option>
                                    <option value="alert-primary">Blue</option>
                                    <option value="alert-danger">Red</option>
                                    <option value="alert-warning">Yellow</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="comment">Bình luận</label>
                            <textarea id="comment" name="comment" class="form-control" placeholder="Nhập nội dung"
                                style="height: 80px"></textarea>

                        </div>
                        <button type="submit" class="btn btn-primary">Gửi bình luận</button>
                    </form>
                </div>
                <div class="mt-3" style="max-height: 300px; overflow: scroll">
                    <div class="alert alert-info alert-dismissible">
                        <button type="button" class="close" onclick="this.parentElement.style.display='none';">&times;</button>
                        <strong>Duy:</strong> Tôi thấy học web nói chung cũng nhàn.
                        <div class="text-right small">10:30 - 10/11/2021</div>
                    </div>
                    <div class="alert alert-danger alert-dismissible">
                        <button type="button" class="close" onclick="this.parentElement.style.display='none';">&times;</button>
                        <strong>Khoa!</strong> Đằng sau 1 lập trình viên thành công chính là một người bạn gái… không
                        tồn tại, CHỈ CÓ ĐÀN ÔNG MỚI MANG LẠI HẠNH PHÚC CHO NHAU THÔI..
                        <div class="text-right small">10:30 - 10/11/2021</div>
                    </div>
                    <div class="alert alert-success alert-dismissible">
                        <button type="button" class="close" onclick="this.parentElement.style.display='none';">&times;</button>
                        <strong>Thủy!</strong> Ê bây, có cảm giác như chúng ta sống trong 1 thế giới giả lập ko?.
                        <div class="text-right small">10:30 - 10/11/2021</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        var defaultComments = $('.alert-dismissible').map(function() {
            var $this = $(this);
            return {
                type: $this.attr('class').split(' ').filter(function(c) { return c.startsWith('alert-') && c !== 'alert-dismissible'; })[0],
                name: $this.find('strong').text().slice(0, -1),
                comment: $this.contents().filter(function() { return this.nodeType === 3; }).text().trim(),
                timestamp: Math.floor(new Date($this.find('.small').text()).getTime() / 1000)
            };
        }).get();
    
        function loadComments() {
            $.get('ex3-api.php', function(data) {
                var comments = JSON.parse(data);
                $('.mt-3').empty();
                if (comments.length === 0) {
                    comments = defaultComments;
                    defaultComments.forEach(function(comment) {
                        $.post('ex3-api.php', comment);
                    });
                }
                comments.forEach(function(comment) {
                    var commentData = JSON.parse(comment);
                    var commentElement = '<div class="alert ' + commentData.type + ' alert-dismissible">' +
                        '<button type="button" class="close" data-timestamp="' + commentData.timestamp + '">&times;</button>' +
                        '<strong>' + commentData.name + ':</strong> ' + commentData.comment +
                        '<div class="text-right small">' + new Date(commentData.timestamp * 1000).toLocaleString() + '</div>' +
                        '</div>';
                    $('.mt-3').append(commentElement); 
                });
            });
        }
    
    
        $('form').submit(function(e) {
            e.preventDefault(); 
            var formData = $(this).serialize();
            $.post('ex3-api.php', formData, function() {
                loadComments();
            });
        });
    
        $(document).on('click', '.close', function() {
            var timestamp = $(this).data('timestamp');
            $.ajax({
                url: 'ex3-api.php?timestamp=' + timestamp,
                type: 'DELETE',
                success: function() {
                    loadComments();
                }
            });
        });
    
        loadComments();
    });
</script>
<!-- nhớ chạy:macbookpro@TTrung-2 lab6_web_522H0148 % php -S localhost:8080
nhớ chạy: macbookpro@TTrung-2 lab6_web_522H0148 % sudo chmod -R 777 /Applications/XAMPP/xamppfiles/htdocs/ để cấp quyền cho thư mục htdocs, cho phép sửa file cmts.txt -->

</html>